<% if (extra.memo) { %>
<p><%- extra.memo.replace(/\n/g, '<br>') %></p>
<% } %>

<div class="jumbotron" id="jumbo">
  <div class="container">
    
    <h1>US Staff Account Summary</h1>
    <p>Staff account summary for US staff living in your region.</p>
    <p>Please review this information and contact any staff needing to address their MPD.</p>

  </div>
</div>
<table class="table">
    <thead>
        <tr>
            <th>Account Num</th>
            <th>Name</th>
            <th>Current Account Balance</th>
            <th>Avg Monthly Balance</th>
            <th># Months in deficit</th>
            <th>Months till deficit</th>
            <th>Phone</th>
            <th>Email</th>
        </tr>
    </thead>
    <tbody>
<%

    //// NOTE: changing the display logic will also need to change the 
    //// assets/opstool/MPDReport/views/MPDReportReview/tableUS.ejs
    //// 
    
    // Returns the integer value of a number string that may include commas.
    var int = function(numString) {
        return parseInt(('' + numString).replace(/,/g, ''));
    }

    var getClass = function(data, field) {
        var result = '';
        var value = int(data[field]);
        
        if (field == 'accountBal') {
            if (value <= 0 || value < int(data.avgPayroll)) {
                result = 'class="balrep-red" ';
            }
            else if (value < int(data.avgPayroll) * 1.5) {
                result = 'class="balrep-orange" ';
            }
            else if (value < int(data.avgPayroll) * 2) {
                result = 'class="balrep-yellow" ';
            }
        }

        else if (field == 'monthsInDeficit') {
            if (value == 1) {
                result = 'class="balrep-yellow" ';
            }
            else if (value == 2) {
                result = 'class="balrep-orange" ';
            }
            else if (value == 3) {
                result = 'class="balrep-red" ';
            }
        }
        
        return result;
    };

%>

    <% people.forEach(function(person) { %>
        <tr>
            <td><%= person.accountNum %></td>
            <td><%= person.hrisName %></td>
            <td <%- getClass(person, 'accountBal') %> >
                <%= person.accountBal %>
            </td>
            <td><%= person.avgAccountBal %></td>
            <td <%- getClass(person, 'monthsInDeficit') %> >
                <%= person.monthsInDeficit %>
            </td>
            <td> ??? </td>
            <td><%= person.phone %></td>
            <td><%= person.email %></td>
        </tr>
    <% }); %>
    </tbody>
</table>    
 